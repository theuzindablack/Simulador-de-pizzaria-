<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pizzaria Tycoon - Velocidade por Staff</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap');
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: 'Poppins', sans-serif; touch-action: none; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; z-index: 10; display: flex; flex-direction: column; gap: 8px; }
        .stat { background: rgba(20, 20, 40, 0.9); padding: 10px 20px; border-radius: 12px; border-left: 6px solid #f1c40f; box-shadow: 0 4px 10px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
        #joy-base { position: absolute; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; display: none; z-index: 100; border: 2px solid rgba(255,255,255,0.2); }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: #fff; border-radius: 50%; box-shadow: 0 0 15px rgba(255,255,255,0.4); }
        .progress-container { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); width: 180px; height: 14px; background: rgba(0,0,0,0.6); border-radius: 20px; display: none; overflow: hidden; border: 2px solid #fff; z-index: 100; }
        #progressBar { height: 100%; width: 0%; background: linear-gradient(90deg, #2ecc71, #f1c40f); }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat"><span>üí∞</span> <span id="moneyText">0</span></div>
    <div class="stat"><span>üçï</span> <span id="handText">0</span> / 20</div>
</div>

<div class="progress-container" id="p-cont"><div id="progressBar"></div></div>
<div id="joy-base"><div id="joy-stick"></div></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let money = 20000; 
let playerHand = []; 
let progress = 0; 
let walkCycle = 0;
let lastPurchaseTime = 0;
let player = { x: 400, y: 350, vx: 0, vy: 0, radius: 15 };
let camPos = { x: 450, y: 350 };
let zoom = 0.55;

let customers = [];
let workers = [];

// Contador de trabalhadores por tipo para calcular velocidade
const staffCount = { MASSA: 0, RECHEIO: 0, FORNO: 0, EMBALAR: 0, VENDEDOR: 0 };

const WORKER_TYPES = {
    MASSA: { color: '#f1c40f', target: {x: 270, y: 140}, price: 5000, label: "BOT MASSA", baseSpeed: 0.4 },
    RECHEIO: { color: '#e74c3c', target: {x: 470, y: 140}, price: 8000, label: "BOT RECHEIO", baseSpeed: 0.35 },
    FORNO: { color: '#e67e22', target: {x: 330, y: 460}, price: 12000, label: "BOT FORNO", baseSpeed: 0.25 },
    EMBALAR: { color: '#9b59b6', target: {x: 530, y: 460}, price: 15000, label: "BOT EMBALO", baseSpeed: 0.45 },
    VENDEDOR: { color: '#2ecc71', target: {x: 600, y: 320}, price: 20000, label: "BOT VENDEDOR", baseSpeed: 0.6 }
};

const tables = [
    { x: 220, y: 180, w: 100, h: 70, z: 35, color: '#f5f6fa', side: '#dcdde1', label: 'MASSA' },
    { x: 420, y: 180, w: 100, h: 70, z: 35, color: '#ecf0f1', side: '#bdc3c7', label: 'RECHEAR' },
    { x: 220, y: 450, w: 100, h: 100, z: 50, color: '#e67e22', side: '#d35400', label: 'FORNO' },
    { x: 420, y: 450, w: 100, h: 70, z: 35, color: '#d35400', side: '#a04000', label: 'EMBALAR' },
    { x: 640, y: 250, w: 40, h: 220, z: 40, color: '#8d6e63', side: '#5d4037', label: 'BALC√ÉO' }
];

const workPads = [
    { x: 270, y: 300, type: 'massa', label: 'PEGAR' },
    { x: 470, y: 300, type: 'recheio', label: 'RECHEAR' },
    { x: 270, y: 580, type: 'forno', label: 'ASSAR' },
    { x: 470, y: 580, type: 'embalar', label: 'CAIXA' },
    { x: 600, y: 360, type: 'delivery', label: 'VENDER' }
];

const hireButtons = [
    { x: 780, y: 820, type: 'MASSA', displayPrice: "$5k" },
    { x: 880, y: 820, type: 'RECHEIO', displayPrice: "$8k" },
    { x: 980, y: 820, type: 'FORNO', displayPrice: "$12k" },
    { x: 1080, y: 820, type: 'EMBALAR', displayPrice: "$15k" },
    { x: 1180, y: 820, type: 'VENDEDOR', displayPrice: "$20k" }
];

class Worker {
    constructor(type) {
        this.type = type;
        this.x = 800 + (Math.random()*50); 
        this.y = 800 + (Math.random()*50);
        this.target = { 
            x: WORKER_TYPES[type].target.x + (Math.random() * 30 - 15), 
            y: WORKER_TYPES[type].target.y + (Math.random() * 30 - 15) 
        };
        this.color = WORKER_TYPES[type].color;
        this.reached = false;
        this.progress = 0;
        this.bob = 0;
    }
    update() {
        if (!this.reached) {
            let dx = this.target.x - this.x; let dy = this.target.y - this.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < 5) this.reached = true;
            else { this.x += (dx/dist)*3; this.y += (dy/dist)*3; this.bob = Math.sin(Date.now()/150)*4; }
        } else {
            // VELOCIDADE AUMENTA COM O N√öMERO DE STAFF DO MESMO TIPO
            let speedMultiplier = 1 + (staffCount[this.type] * 0.2); 
            this.progress += WORKER_TYPES[this.type].baseSpeed * speedMultiplier;
            this.bob = Math.sin(Date.now() / (100 / speedMultiplier)) * 4;

            if (this.progress >= 100) {
                this.progress = 0;
                if (this.type === 'MASSA' && playerHand.length < 20) playerHand.push('massa');
                if (this.type === 'RECHEIO' && playerHand.includes('massa')) playerHand[playerHand.indexOf('massa')] = 'recheada';
                if (this.type === 'FORNO' && playerHand.includes('recheada')) playerHand[playerHand.indexOf('recheada')] = 'assada';
                if (this.type === 'EMBALAR' && playerHand.includes('assada')) playerHand[playerHand.indexOf('assada')] = 'caixa';
                
                if (this.type === 'VENDEDOR' && playerHand.includes('caixa')) {
                    let firstCust = customers.find(c => c.state === 'WAITING');
                    if (firstCust) {
                        playerHand.splice(playerHand.lastIndexOf('caixa'), 1);
                        firstCust.pizzasReceived++;
                        money += 2000;
                        if(firstCust.pizzasReceived >= firstCust.pizzasNeeded) firstCust.state = 'LEAVING';
                    }
                }
            }
        }
    }
}

function toIso(x, y) { return { x: (x - y) * zoom, y: (x + y) * 0.5 * zoom }; }

function checkCollision(nx, ny, radius) {
    for (let o of tables) {
        if (nx + radius > o.x && nx - radius < o.x + o.w && ny + radius > o.y && ny - radius < o.y + o.h) return true;
    }
    return false;
}

function spawnCustomer() {
    if (customers.length < 6) {
        customers.push({ 
            x: 730, y: -100, state: 'ENTERING', 
            color: `hsl(${Math.random() * 360}, 60%, 50%)`,
            pizzasNeeded: Math.floor(Math.random() * 3) + 1,
            pizzasReceived: 0
        });
    }
}

function update() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let nextX = player.x + player.vx; let nextY = player.y + player.vy;
    if (!checkCollision(nextX, player.y, player.radius)) player.x = nextX;
    if (!checkCollision(player.x, nextY, player.radius)) player.y = nextY;
    camPos.x += (player.x - camPos.x) * 0.1; camPos.y += (player.y - camPos.y) * 0.1;

    workers.forEach(w => w.update());
    
    customers.forEach((c, i) => {
        let targetY = 280 + (i * 85); 
        if(c.state === 'ENTERING') {
            let canMove = true;
            if (i > 0 && Math.abs(c.y - customers[i-1].y) < 90) canMove = false;
            if(c.y < targetY && canMove) c.y += 4; else if (c.y >= targetY) c.state = 'WAITING';
        } else if(c.state === 'WAITING' && i > 0 && c.y > 280 + (i * 85)) {
             c.state = 'ENTERING';
        } else if(c.state === 'LEAVING') {
            c.y += 6; if(c.y > 1000) { customers.splice(i, 1); spawnCustomer(); }
        }
    });

    let inZone = false;
    workPads.forEach(pad => {
        let dist = Math.sqrt(Math.pow(player.x - pad.x, 2) + Math.pow(player.y - pad.y, 2));
        if(dist < 50) {
            inZone = true; 
            // Velocidade do jogador tamb√©m aumenta com os bots (opcional, aqui mantivemos base + leve b√¥nus)
            progress += 4;
            document.getElementById('p-cont').style.display = 'block';
            document.getElementById('progressBar').style.width = progress + '%';
            if(progress >= 100) {
                if(pad.type === 'massa' && playerHand.length < 20) playerHand.push('massa');
                if(pad.type === 'recheio' && playerHand.includes('massa')) playerHand[playerHand.indexOf('massa')] = 'recheada';
                if(pad.type === 'forno' && playerHand.includes('recheada')) playerHand[playerHand.indexOf('recheada')] = 'assada';
                if(pad.type === 'embalar' && playerHand.includes('assada')) playerHand[playerHand.indexOf('assada')] = 'caixa';
                if(pad.type === 'delivery' && playerHand.includes('caixa')) { 
                    let firstCust = customers.find(c => c.state === 'WAITING');
                    if(firstCust) {
                        playerHand.splice(playerHand.lastIndexOf('caixa'), 1);
                        firstCust.pizzasReceived++;
                        money += 2000;
                        if(firstCust.pizzasReceived >= firstCust.pizzasNeeded) firstCust.state = 'LEAVING';
                    }
                }
                progress = 0;
            }
        }
    });

    hireButtons.forEach(b => {
        let dist = Math.sqrt(Math.pow(player.x - b.x, 2) + Math.pow(player.y - b.y, 2));
        if (dist < 50 && Date.now() - lastPurchaseTime > 800) {
            if (money >= WORKER_TYPES[b.type].price) {
                money -= WORKER_TYPES[b.type].price; 
                workers.push(new Worker(b.type)); 
                staffCount[b.type]++; // INCREMENTA O CONTADOR DE VELOCIDADE
                lastPurchaseTime = Date.now();
            }
        }
    });

    if(!inZone) { progress = 0; document.getElementById('p-cont').style.display = 'none'; }
    document.getElementById('moneyText').innerText = money.toLocaleString();
    document.getElementById('handText').innerText = playerHand.length;
}

function drawIsoBox(x, y, w, h, z, color, sideColor, isZone = false) {
    let p1 = toIso(x, y); let p2 = toIso(x + w, y);
    let p3 = toIso(x + w, y + h); let p4 = toIso(x, y + h);
    let hz = z * zoom;
    if(isZone) {
        ctx.fillStyle = color; ctx.globalAlpha = 0.4;
        ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.lineTo(p3.x, p3.y); ctx.lineTo(p4.x, p4.y); ctx.fill();
        ctx.globalAlpha = 1.0; return;
    }
    ctx.fillStyle = sideColor;
    ctx.beginPath(); ctx.moveTo(p2.x, p2.y); ctx.lineTo(p2.x, p2.y - hz); ctx.lineTo(p3.x, p3.y - hz); ctx.lineTo(p3.x, p3.y); ctx.fill();
    ctx.filter = "brightness(80%)";
    ctx.beginPath(); ctx.moveTo(p3.x, p3.y); ctx.lineTo(p3.x, p3.y - hz); ctx.lineTo(p4.x, p4.y - hz); ctx.lineTo(p4.x, p4.y); ctx.fill();
    ctx.filter = "none";
    ctx.fillStyle = color;
    ctx.beginPath(); ctx.moveTo(p1.x, p1.y - hz); ctx.lineTo(p2.x, p2.y - hz); ctx.lineTo(p3.x, p3.y - hz); ctx.lineTo(p4.x, p4.y - hz); ctx.fill();
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save();
    let cI = toIso(camPos.x, camPos.y);
    ctx.translate(canvas.width/2 - cI.x, canvas.height/2 - cI.y);

    drawIsoBox(700, -200, 300, 1200, 2, "#34495e", "#2c3e50"); 
    drawIsoBox(150, 150, 540, 550, 5, "#2c3e50", "#1a252f");
    drawIsoBox(750, 750, 420, 160, 5, "#4a3c31", "#2d241e");

    workPads.forEach(pad => {
        let p = toIso(pad.x, pad.y);
        ctx.fillStyle = "#2ecc71"; ctx.globalAlpha = 0.3;
        ctx.beginPath(); ctx.ellipse(p.x, p.y, 45 * zoom, 22 * zoom, 0, 0, Math.PI * 2); ctx.fill();
        ctx.globalAlpha = 1.0;
        ctx.fillStyle = "white"; ctx.font = "bold 10px Poppins"; ctx.textAlign = "center";
        ctx.fillText(pad.label, p.x, p.y - 5);
    });

    tables.forEach(t => {
        drawIsoBox(t.x, t.y, t.w, t.h, t.z, t.color, t.side);
    });

    hireButtons.forEach(b => {
        drawIsoBox(b.x-40, b.y-40, 80, 80, 0, "#2ecc71", "#27ae60", true);
        let p = toIso(b.x, b.y);
        ctx.fillStyle = "white"; ctx.font = "bold 8px Poppins"; ctx.textAlign = "center";
        ctx.fillText(WORKER_TYPES[b.type].label + " (" + staffCount[b.type] + ")", p.x, p.y - 8);
        ctx.fillStyle = "#f1c40f"; ctx.font = "bold 12px Poppins"; ctx.fillText(b.displayPrice, p.x, p.y + 12);
    });

    customers.forEach(cust => {
        let cI = toIso(cust.x, cust.y);
        drawIsoBox(cust.x-15, cust.y-15, 30, 30, 40, cust.color, "#333");
        ctx.fillStyle = "#ffdbac"; ctx.beginPath(); ctx.arc(cI.x, cI.y - (45 * zoom), 12 * zoom, 0, Math.PI*2); ctx.fill();
        if(cust.state === 'WAITING' || cust.state === 'ENTERING') {
            let remain = cust.pizzasNeeded - cust.pizzasReceived;
            if (remain > 0) {
                ctx.fillStyle = "white"; ctx.beginPath(); ctx.roundRect(cI.x - 25, cI.y - 85, 50, 25, 5); ctx.fill();
                ctx.fillStyle = "black"; ctx.font = "bold 12px Poppins"; ctx.textAlign = "center";
                ctx.fillText("üçï x" + remain, cI.x, cI.y - 68);
            }
        }
    });

    workers.forEach(w => {
        let wI = toIso(w.x, w.y);
        drawIsoBox(w.x-12, w.y-12, 24, 24, 35 + w.bob, w.color, "#333");
        ctx.fillStyle = "#ffdbac"; ctx.beginPath(); ctx.arc(wI.x, wI.y - (45*zoom) + (w.bob*zoom), 10*zoom, 0, Math.PI*2); ctx.fill();
    });

    let pI = toIso(player.x, player.y);
    let bob = Math.sin(walkCycle) * 4;
    drawIsoBox(player.x-10, player.y-10, 20, 20, 35 + bob, "#3498db", "#2980b9");
    ctx.fillStyle = "#ffdbac"; ctx.beginPath(); ctx.arc(pI.x, pI.y - (45*zoom) + (bob*zoom), 10*zoom, 0, Math.PI*2); ctx.fill();

    let stackHeight = 55;
    playerHand.forEach((h) => {
        let handIso = toIso(player.x + 10, player.y - 10);
        let drawY = handIso.y - (stackHeight + bob) * zoom;
        if (h === 'caixa') {
            drawIsoBox(player.x + 5, player.y - 15, 35, 35, stackHeight + bob + 10, "#d2b48c", "#8b4513");
            stackHeight += 12;
        } else {
            ctx.fillStyle = (h === 'assada') ? "#8b4513" : "#f1c40f"; 
            ctx.beginPath(); ctx.ellipse(handIso.x, drawY, 20*zoom, 10*zoom, 0, 0, Math.PI * 2); ctx.fill();
            if(h === 'recheada' || h === 'assada') {
                ctx.fillStyle = "#e74c3c"; ctx.beginPath(); ctx.ellipse(handIso.x, drawY, 14*zoom, 7*zoom, 0, 0, Math.PI * 2); ctx.fill();
            }
            stackHeight += 5;
        }
    });

    ctx.restore();
    requestAnimationFrame(draw);
}

let joyActive = false; let joyOrigin = { x: 0, y: 0 };
const handleMove = (x, y) => {
    let dx = x - joyOrigin.x, dy = y - joyOrigin.y;
    let d = Math.sqrt(dx*dx+dy*dy), mx = dx/(d||1), my = dy/(d||1);
    let speed = Math.min(d, 50) / 7;
    player.vx = mx * speed; player.vy = my * speed;
    walkCycle += 0.2;
    document.getElementById('joy-stick').style.transform = `translate(${mx*25}px, ${my*25}px)`;
};
window.addEventListener('mousedown', e => { joyActive = true; joyOrigin = { x: e.clientX, y: e.clientY }; document.getElementById('joy-base').style.display = 'block'; document.getElementById('joy-base').style.left = (joyOrigin.x-50)+'px'; document.getElementById('joy-base').style.top = (joyOrigin.y-50)+'px'; });
window.addEventListener('mousemove', e => { if(joyActive) handleMove(e.clientX, e.clientY); });
window.addEventListener('mouseup', () => { joyActive = false; document.getElementById('joy-base').style.display='none'; player.vx=0; player.vy=0; });
window.addEventListener('touchstart', e => { joyActive = true; joyOrigin = { x: e.touches[0].clientX, y: e.touches[0].clientY }; document.getElementById('joy-base').style.display = 'block'; document.getElementById('joy-base').style.left = (joyOrigin.x-50)+'px'; document.getElementById('joy-base').style.top = (joyOrigin.y-50)+'px'; });
window.addEventListener('touchmove', e => { if(joyActive) handleMove(e.touches[0].clientX, e.touches[0].clientY); });
window.addEventListener('touchend', () => { joyActive = false; document.getElementById('joy-base').style.display='none'; player.vx=0; player.vy=0; });

setInterval(spawnCustomer, 3000);
setInterval(update, 1000/60); draw();
</script>
</body>
</html>
