
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pizzaria Tycoon - Zonas de A√ß√£o</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: sans-serif; touch-action: none; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; pointer-events: none; z-index: 10; }
        .stat { background: rgba(0,0,0,0.9); padding: 8px 15px; border-radius: 8px; margin-bottom: 5px; border-left: 5px solid #4caf50; font-weight: bold; min-width: 150px; }
        canvas { display: block; }
        #joy-base { position: absolute; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; display: none; z-index: 100; pointer-events: none; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: rgba(255,255,255,0.5); border-radius: 50%; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat">üí∞ DINHEIRO: R$ <span id="moneyText">0</span></div>
    <div class="stat">üçï PIZZAS: <span id="handText">0</span></div>
</div>

<div id="joy-base"><div id="joy-stick"></div></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const joyBase = document.getElementById('joy-base');
const joyStick = document.getElementById('joy-stick');

let money = 0;
let playerHand = []; 
let progress = 0;
let lastAction = 0;
let customers = [];
let lastSpawn = 0;

function toIso(x, y) {
    return { isoX: (x - y) * 0.8, isoY: (x + y) * 0.4 };
}

let player = { x: 150, y: 150, speed: 5, vx: 0, vy: 0 };
let joyActive = false;
let joyOrigin = { x: 0, y: 0 };

const pizzaHouse = { x: 20, y: 20, w: 320, h: 320 };

// M√ÅQUINAS (Objetos com colis√£o)
const obstacles = [
    { x: 20, y: 20, w: 60, h: 60, color: '#f5deb3', label: 'M√ÅQ. MASSA', z: 25, id: 'massa' },
    { x: 100, y: 20, w: 60, h: 60, color: '#e91e63', label: 'M√ÅQ. RECHEIO', z: 25, id: 'recheio' },
    { x: 20, y: 240, w: 80, h: 80, color: '#444', label: 'FORNO', z: 35, id: 'forno' },
    { x: 260, y: 80, w: 40, h: 160, color: '#8d6e63', label: 'BALC√ÉO', z: 35, id: 'counter' }
];

// AS ZONAS VERDES (Onde o jogador precisa pisar)
const actionZones = [
    { x: 30, y: 85, w: 40, h: 40, type: 'massa', label: 'Pise aqui' },
    { x: 110, y: 85, w: 40, h: 40, type: 'recheio', label: 'Pise aqui' },
    { x: 105, y: 260, w: 40, h: 40, type: 'forno', label: 'Pise aqui' },
    { x: 220, y: 110, w: 40, h: 100, type: 'delivery', label: 'ENTREGA' }
];

// CONTROLES
window.addEventListener('touchstart', e => {
    let t = e.touches[0];
    if (t.clientX < window.innerWidth / 2) {
        joyActive = true; joyOrigin = { x: t.clientX, y: t.clientY };
        joyBase.style.display = 'block'; joyBase.style.left = (joyOrigin.x-50)+'px'; joyBase.style.top = (joyOrigin.y-50)+'px';
    }
});
window.addEventListener('touchmove', e => {
    if (!joyActive) return;
    let t = e.touches[0];
    let dx = t.clientX - joyOrigin.x, dy = t.clientY - joyOrigin.y;
    let dist = Math.sqrt(dx*dx + dy*dy), moveX = dx/(dist||1), moveY = dy/(dist||1);
    joyStick.style.transform = `translate(${moveX*Math.min(dist,40)}px, ${moveY*Math.min(dist,40)}px)`;
    player.vx = moveX * player.speed; player.vy = moveY * player.speed;
});
window.addEventListener('touchend', () => { joyActive = false; joyBase.style.display = 'none'; player.vx = 0; player.vy = 0; });

function checkRectCollision(px, py, rect) {
    return px > rect.x && px < rect.x + rect.w && py > rect.y && py < rect.y + rect.h;
}

function update() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    
    // Movimento com Colis√£o nos Obst√°culos
    let nextX = player.x + player.vx;
    let nextY = player.y + player.vy;
    let canMoveX = true, canMoveY = true;
    obstacles.forEach(ob => {
        if(checkRectCollision(nextX, player.y, ob)) canMoveX = false;
        if(checkRectCollision(player.x, nextY, ob)) canMoveY = false;
    });
    if(canMoveX) player.x = nextX;
    if(canMoveY) player.y = nextY;

    // Limites da Casa
    player.x = Math.max(pizzaHouse.x + 5, Math.min(pizzaHouse.x + pizzaHouse.w - 5, player.x));
    player.y = Math.max(pizzaHouse.y + 5, Math.min(pizzaHouse.y + pizzaHouse.h - 5, player.y));

    const now = Date.now();
    let interacting = false;

    // L√≥gica das Zonas Verdes
    actionZones.forEach(zone => {
        if (checkRectCollision(player.x, player.y, zone)) {
            if (zone.type === 'massa' && playerHand.length < 6) {
                interacting = true; progress += 2.5;
                if(progress >= 100) { playerHand.push('massa'); progress = 0; }
            }
            else if (zone.type === 'recheio' && playerHand.includes('massa')) {
                interacting = true; progress += 2;
                if(progress >= 100) { playerHand[playerHand.indexOf('massa')] = 'recheada'; progress = 0; }
            }
            else if (zone.type === 'forno' && playerHand.includes('recheada')) {
                interacting = true; progress += 1.5;
                if(progress >= 100) { playerHand[playerHand.indexOf('recheada')] = 'assada'; progress = 0; }
            }
            else if (zone.type === 'delivery') {
                let target = customers.find(c => c.arrived && !c.leaving);
                if(target && playerHand.includes('assada') && now - lastAction > 500) {
                    playerHand.splice(playerHand.indexOf('assada'), 1);
                    money += 1500; lastAction = now;
                    target.leaving = true; target.arrived = false;
                }
            }
        }
    });

    if(!interacting) progress = 0;

    // Clientes
    if(now - lastSpawn > 5000 && customers.length < 3) { customers.push({ x: 500, y: 160, arrived: false, leaving: false }); lastSpawn = now; }
    customers.forEach(c => {
        let targetX = 330; 
        if(!c.leaving) { if(c.x > targetX) c.x -= 2; else { c.x = targetX; c.arrived = true; } }
        else { c.x += 6; }
    });
    customers = customers.filter(c => c.x < 800);

    document.getElementById('moneyText').innerText = money;
    document.getElementById('handText').innerText = playerHand.length;
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save();
    const pPos = toIso(player.x, player.y);
    ctx.translate(canvas.width/2 - pPos.isoX, canvas.height/2 - pPos.isoY);

    // 1. Ch√£o da Casa
    ctx.fillStyle = "#ecf0f1"; ctx.beginPath();
    let h1=toIso(pizzaHouse.x, pizzaHouse.y), h2=toIso(pizzaHouse.x+pizzaHouse.w, pizzaHouse.y),
        h3=toIso(pizzaHouse.x+pizzaHouse.w, pizzaHouse.y+pizzaHouse.h), h4=toIso(pizzaHouse.x, pizzaHouse.y+pizzaHouse.h);
    ctx.moveTo(h1.isoX, h1.isoY); ctx.lineTo(h2.isoX, h2.isoY); ctx.lineTo(h3.isoX, h3.isoY); ctx.lineTo(h4.isoX, h4.isoY); ctx.fill();

    // 2. DESENHAR ZONAS VERDES (No ch√£o)
    actionZones.forEach(z => {
        const z1=toIso(z.x, z.y), z2=toIso(z.x+z.w, z.y), z3=toIso(z.x+z.w, z.y+z.h), z4=toIso(z.x, z.y+z.h);
        ctx.fillStyle = "rgba(46, 204, 113, 0.5)"; ctx.beginPath();
        ctx.moveTo(z1.isoX, z1.isoY); ctx.lineTo(z2.isoX, z2.isoY); ctx.lineTo(z3.isoX, z3.isoY); ctx.lineTo(z4.isoX, z4.isoY); ctx.fill();
        ctx.strokeStyle = "#27ae60"; ctx.lineWidth = 2; ctx.stroke();
    });

    // 3. DESENHAR OBST√ÅCULOS (M√°quinas e Balc√£o 3D)
    obstacles.forEach(ob => {
        const o1=toIso(ob.x, ob.y), o2=toIso(ob.x+ob.w, ob.y), o3=toIso(ob.x+ob.w, ob.y+ob.h), o4=toIso(ob.x, ob.y+ob.h);
        ctx.fillStyle = "#7f8c8d"; ctx.beginPath(); // Sombra lateral
        ctx.moveTo(o4.isoX, o4.isoY); ctx.lineTo(o3.isoX, o3.isoY); ctx.lineTo(o3.isoX, o3.isoY-ob.z); ctx.lineTo(o4.isoX, o4.isoY-ob.z); ctx.fill();
        ctx.fillStyle = ob.color; ctx.beginPath(); // Topo
        ctx.moveTo(o1.isoX, o1.isoY-ob.z); ctx.lineTo(o2.isoX, o2.isoY-ob.z); ctx.lineTo(o3.isoX, o3.isoY-ob.z); ctx.lineTo(o4.isoX, o4.isoY-ob.z); ctx.fill();
        ctx.fillStyle = "white"; ctx.font = "bold 9px Arial"; ctx.fillText(ob.label, o1.isoX, o1.isoY-ob.z-5);
    });

    // 4. JOGADOR E PIZZAS NA M√ÉO
    ctx.fillStyle = "#3498db"; ctx.beginPath(); ctx.arc(pPos.isoX, pPos.isoY - 12, 12, 0, Math.PI*2); ctx.fill();
    playerHand.forEach((item, i) => {
        let col = item==='assada' ? "#f39c12" : (item==='recheada' ? "#e91e63" : "#fff");
        ctx.fillStyle = col; ctx.beginPath(); ctx.ellipse(pPos.isoX, pPos.isoY - (25 + i*5), 10, 5, 0, 0, Math.PI*2); ctx.fill(); ctx.stroke();
    });

    // Barra de Progresso
    if(progress > 0) {
        ctx.fillStyle="white"; ctx.fillRect(pPos.isoX-15, pPos.isoY-65, 30, 4);
        ctx.fillStyle="#2ecc71"; ctx.fillRect(pPos.isoX-15, pPos.isoY-65, (progress/100)*30, 4);
    }

    // 5. CLIENTES
    customers.forEach(c => {
        const cPos = toIso(c.x, c.y);
        ctx.fillStyle = "#e67e22"; ctx.beginPath(); ctx.arc(cPos.isoX, cPos.isoY - 15, 12, 0, Math.PI*2); ctx.fill();
    });

    ctx.restore();
    requestAnimationFrame(draw);
}
setInterval(update, 1000/60);
draw();
</script>
</body>
</html>
